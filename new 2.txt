import camelot
import os
import pandas as pd

pdf_path = r"C:\Users\TAQ7353\UTR\LOB_ActivitySummary_FillingRate\test\your_file.pdf"
output_folder = r"C:\Users\TAQ7353\UTR\LOB_ActivitySummary_FillingRate\test"

tables = camelot.read_pdf(pdf_path, pages="all")

for i, table in enumerate(tables):
    df = table.df
    excel_path = os.path.join(output_folder, f"table_{i+1}.xlsx")
    df.to_excel(excel_path, index=False)
    print(f"✅ Saved: {excel_path}")

    # === STEP 2: Search for "Summary of Activity" and extract the next line ===
    extracted_value = None

    for col in df.columns:
        for cell in df[col]:
            if isinstance(cell, str) and "Summary of Activity" in cell:
                lines = [line.strip() for line in cell.split("\n") if line.strip()]
                for j, line in enumerate(lines):
                    if "Summary of Activity" in line and j + 1 < len(lines):
                        extracted_value = lines[j + 1]  # line immediately below
                        break
            if extracted_value:
                break
        if extracted_value:
            break

    # === STEP 3: Save extracted value ===
    if extracted_value:
        summary_path = os.path.join(output_folder, f"summary_of_activity_table_{i+1}.txt")
        with open(summary_path, "w", encoding="utf-8") as f:
            f.write(extracted_value)
        print(f"🎯 Extracted Summary of Activity: {extracted_value}")
        print(f"💾 Saved to: {summary_path}")
    else:
        print("⚠️ 'Summary of Activity' not found in this table.")
